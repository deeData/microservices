@model List<LedgerItemDto>
@using System.Text.Json;
@{
    Layout = "~/Views/Shared/_LayoutBilling.cshtml";
    var myModel = JsonSerializer.Serialize(Model, new JsonSerializerOptions() { 
        //have set json keys as lower case
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
    });
}

@section Styles{
    @*stripe payment widget*@
    <link href="~/css/stripe.css" rel="stylesheet" />
    @*ledger datatable*@
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css" />

}

<div class="container-fluid bg-light">


    <div class="row mt-3 mb-2">
        <div class="col-md-3 fw-bold fs-4">Billing Ledger</div>
    </div>
    <div class="container-fluid">
        <div class="row mt-3 mb-2">
            @*ledger datable*@
            <table id="dataTable" class="table table-responsive table-striped table-bordered table-hover" data-s>
                <thead>
                    <tr>
                        <th data-field="ledgerItemId" data-visible="true" hidden>LedgerItemId</th>
                        <th data-field="posted" data-formatter="dateTimeStamp">Posted</th>
                        <th data-field="description">Billing Entry</th>
                        <th data-field="debit" data-formatter="currencyFormat">Debit</th>
                        <th data-field="credit" data-formatter="currencyFormat">Credit</th>
                        <th data-formatter="getBalance">Adjusted Balance</th>
                        <th data-field="remarks">Remarks</th>
                        <th data-field="user">Admin User</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>


    <div class="row">
        <div class="container mt-xxl-1 col-md-6" style="min-width: 30rem;">
            <div class="card text-white bg-secondary mb-3" id="pymtDiv">
                <div class="container">
                    <div class="card-header mt-1">
                        Payment Processing
                        <i class="bi bi-arrow-counterclockwise float-end popover-hover" data-content="Refresh for every new payment transaction."></i>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4" id="submittedMessage">
                                <h8>Enter and Submit Payment Amount.</h8>
                            </div>
                            <div class="col-3">
                                <input class="form-control" type="text" id="payAmount" />
                            </div>
                            <div class="col-3">
                                <button class="btn btn-primary" id="submitAmt">Submit</button>
                            </div>
                        </div>
                    </div>
                    <span class="card-header text-danger font-weight-bold">System Message</span><small><span id="stripeResponseTime"></span></small>
                    <div class="card-body">
                        <span class="card-text bg-danger text-light font-weight-bold" id="stripeResponse">"Plase stand by......"</span>
                    </div>

                    @*HIDE UNDER USER SUBMITS PAYMENT AMOUNT*@
                    <div class="card-body" style="display: none" id="stripeWidget">
                        <div class="card-header mt-1">
                            <h6 class="text-primary font-weight-bolder bg-light">Please enter test credit card info for payment processing. See "Testing Options".</h6>
                        </div>
                        <!-- Stripe payment widget -->
                        <form id="payment-form" class="container">
                            <div id="card-element"><!--Stripe.js injects the Card Element--></div>
                            <button id="submit">
                                <div class="spinner hidden" id="spinner"></div>
                                <span id="button-text">Pay now</span>
                            </button>
                            <p id="card-error" role="alert"></p>
                            <p class="result-message hidden">
                                Payment succeeded, see the result in your
                                <a href="" target="_blank">Stripe dashboard.</a> Refresh the page to pay again.
                            </p>
                        </form>
                    </div>

                </div>
            </div>
        </div>
        <div class="container mt-xxl-1 col-md-6" style="min-width: 30rem;">
            <div class="card text-white bg-secondary mb-3">
                <div class="card-header mt-1">Testing Options</div>
                <div class="card-body">
                    <h5 class="card-title">Stripe Integration Testing</h5>
                    <p class="card-text">
                        Genuine card information cannot be used in test mode. Instead, use any of the following test card numbers,
                        a valid expiration date in the future, and any random CVC number, to create a successful payment. Each basic test card’s billing country is set to U.S.
                    </p>
                    <div class="row mb-1">
                        <div class="col-6 rounded-end">Card Number</div>
                        <div class="col-6 rounded-end">Description</div>
                    </div>
                    <div id="el">
                        <div class="row mb-1">
                            <div class="col-6 rounded-end">
                                <div>
                                    <input type="text" value="4242 4242 4242 4242" class="myInput" readonly />
                                    <i class="bi bi-clipboard" style="position: absolute; padding-left: 7px"></i>
                                </div>
                            </div>
                            <div class="col-6 rounded-end">
                                <p class="m-1">Visa credit card for successful payment.</p>
                            </div>
                        </div>
                        <div class="row mb-1">
                            <div class="col-6 rounded-end">
                                <div>
                                    <input type="text" value="4000 0000 0000 0002" class="myInput" readonly />
                                    <i class="bi bi-clipboard" style="position: absolute; padding-left: 7px"></i>
                                </div>
                            </div>
                            <div class="col-6 rounded-end">
                                <p class="m-1">Charge is declined with a card_declined code.</p>
                            </div>
                        </div>
                        <div class="row mb-1">
                            <div class="col-6 rounded-end">
                                <div>
                                    <input type="text" value="4000 0000 0000 3220" class="myInput" readonly />
                                    <i class="bi bi-clipboard" style="position: absolute; padding-left: 7px"></i>
                                </div>
                            </div>
                            <div class="col-6 rounded-end">
                                <p class="m-1">
                                    3D Secure 2 authentication must be completed for the payment to be successful.
                                    By default, your Radar rules will request 3D Secure authentication for this card.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <h10 style="font-style:italic">reference: <a href="https://stripe.com/docs/testing" target="_blank">https://stripe.com/docs/testing</a></h10>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>



@section Scripts{

    <script>
        //get model from backend to front end
        var s = `@Html.Raw(myModel)`;
        var jsonData = JSON.parse(s);
    </script>

}
